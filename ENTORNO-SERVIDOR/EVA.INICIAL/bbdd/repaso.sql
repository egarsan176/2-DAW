-- Crear una base de datos haciendo uso de sentencias DDL, y posteriormente insertar, modificar, borrar y consultar información haciendo uso de sentencias DML.


--> 1. CREACIÓN DE TABLAS 

/*DROP TABLE ALUMNO_ASIGNATURA;
DROP TABLE ASIGNATURA;
DROP TABLE PROFESOR;
DROP TABLE ALUMNO;
DROP TABLE PERSONA;
DROP TABLE TITULACION;*/

CREATE TABLE TITULACION (
IDTITULACION VARCHAR2(6),
NOMBRE VARCHAR2(30),
CONSTRAINT PK_TITULACION PRIMARY KEY(IDTITULACION)
);

CREATE TABLE PERSONA (
DNI VARCHAR2(11),
NOMBRE VARCHAR2(30),
APELLIDO VARCHAR2(30),
TELEFONO VARCHAR2(9),
FECHA_NTO DATE,
CONSTRAINT PK_PERSONA PRIMARY KEY(DNI)
);

CREATE TABLE ALUMNO (
IDALUMNO VARCHAR2(7),
DNI VARCHAR2(11),
EDAD NUMBER,
CONSTRAINT PK_ALUMNO PRIMARY KEY(IDALUMNO),
CONSTRAINT FK1_ALUMNO FOREIGN KEY (DNI) REFERENCES PERSONA(DNI)
);

CREATE TABLE PROFESOR (
IDPROFESOR VARCHAR2(4),
DNI VARCHAR2(11),
CONSTRAINT PK_PROFESOR PRIMARY KEY(IDPROFESOR),
CONSTRAINT FK1_PROFESOR FOREIGN KEY(DNI) REFERENCES PERSONA(DNI)
);

CREATE TABLE ASIGNATURA (
IDASIGNATURA VARCHAR2(6),
NOMBRE VARCHAR2(20),
IDPROFESOR VARCHAR2(4),
IDTITULACION VARCHAR2(6),
CURSO NUMBER,
CONSTRAINT PK_ASIGNATURA PRIMARY KEY(IDASIGNATURA),
CONSTRAINT FK1_ASIGNATURA FOREIGN KEY(IDPROFESOR) REFERENCES PROFESOR(IDPROFESOR),
CONSTRAINT FK2_ASIGNATURA FOREIGN KEY (IDTITULACION) REFERENCES TITULACION(IDTITULACION)
);

CREATE TABLE  ALUM_ASIG (
IDALUMNO VARCHAR2(7),
IDASIGNATURA VARCHAR2(6),
NUMEROMATRICULA NUMBER,
CONSTRAINT PK_ALUM_ASIG PRIMARY KEY(IDALUMNO,IDASIGNATURA,NUMEROMATRICULA),
CONSTRAINT FK1_ALUM_ASIG FOREIGN KEY(IDALUMNO) REFERENCES ALUMNO(IDALUMNO),
CONSTRAINT FK2_ALUM_ASIG FOREIGN KEY(IDASIGNATURA) REFERENCES ASIGNATURA(IDASIGNATURA)
);


--> 2 AÑADIDO DE DATOS A LAS TABLAS

INSERT INTO TITULACION VALUES ('1234','BIOLOGIA');
INSERT INTO TITULACION VALUES ('1235','INFORMATICA');
INSERT INTO TITULACION VALUES ('1236','FISICA');

INSERT INTO PERSONA VALUES ('41526378L','PEPA','GARCIA','633211548',TO_DATE('4/4/1990','DD/MM/YYYY'));
INSERT INTO PERSONA VALUES ('49632054M','LUIS','GOMEZ','611233548',TO_DATE('15/08/1993','DD/MM/YYYY'));
INSERT INTO PERSONA VALUES ('26547887J','MARIA','PEDROSO','66699878',TO_DATE('10/10/1989','DD/MM/YYYY'));
INSERT INTO PERSONA VALUES ('26544778P','JOSE','PEREZ','777986512',TO_DATE('18/4/1969','DD/MM/YYYY'));
INSERT INTO PERSONA VALUES ('28554120D','OLGA','ESPINOSO','777854102',TO_DATE('20/07/1961','DD/MM/YYYY'));
INSERT INTO PERSONA VALUES ('28996632F','LOURDES','HERRERA','600500236',TO_DATE('10/12/1972','DD/MM/YYYY'));

INSERT INTO ALUMNO VALUES ('A111110', '41526378L', 31);
INSERT INTO ALUMNO VALUES ('A111111', '49632054M', 28);
INSERT INTO ALUMNO VALUES ('A111112', '26547887J', 32);

INSERT INTO PROFESOR VALUES ('P203','26544778P');
INSERT INTO PROFESOR VALUES ('P204','28554120D');
INSERT INTO PROFESOR VALUES ('P205','28996632F');

INSERT INTO ASIGNATURA VALUES ('333330', 'bioquimica', 'P203', '1234', 2);
INSERT INTO ASIGNATURA VALUES ('212120', 'matematicas', 'P204', '1235', 1);
INSERT INTO ASIGNATURA VALUES ('666001', 'quimica', 'P205', '1236', 1);
INSERT INTO ASIGNATURA VALUES ('500001', 'fisica', 'P205', '1236', 2);

INSERT INTO ALUM_ASIG VALUES ('A111110', '333330', 112);
INSERT INTO ALUM_ASIG VALUES ('A111111','212120', 116);
INSERT INTO ALUM_ASIG VALUES ('A111112','666001', 126);


--> USO DE SENTENCIAS DDL

-- MODIFICACION DE TABLA (AÑADIR UNA COLUMNA):
ALTER TABLE PROFESOR ADD (ANTIGUEDAD NUMBER);
-- MODIFICACION DE TABLA (MODIFICAR UNA COLUMNA):
ALTER TABLE ASIGNATURA MODIFY (NOMBRE VARCHAR2(20) NOT NULL);
-- MODIFICACION DE TABLA (BORRAR UNA COLUMNA):
ALTER TABLE ALUMNO DROP (EDAD);

--> USO DE SENTENCIAS DML

-- MODIFICACION DE DATOS:

/*QUE TODOS LOS NOMBRES DE ASIGNATURAS APAREZCAN EN MAYÚSCULAS*/
UPDATE ASIGNATURA SET NOMBRE = UPPER(NOMBRE);

/*CAMBIAR EL NUMERO DE TELEFONO DE LA PERSONA CON DNI 26547887J*/
UPDATE PERSONA SET TELEFONO=688000111 WHERE DNI = '26547887J';

/*ELIMINAR LA ASIGNATURA CON ID 500001*/
DELETE FROM ASIGNATURA WHERE IDASIGNATURA = '500001';

--CONSULTAS

/*MOSTRAR TODOS LOS DATOS DE LA TABLA ASIGNATURA*/
SELECT * FROM ASIGNATURA;

/*MUESTRA LAS ASIGNATURAS QUE NO SEAN DE SEGUNDO CURSO*/
SELECT NOMBRE, CURSO FROM ASIGNATURA WHERE CURSO NOT IN 2;

/*MOSTRAR LAS PERSONAS CUYO NUMERO DE TELEFONO TERMINA EN 2*/
SELECT NOMBRE, APELLIDO FROM PERSONA WHERE TELEFONO like '%2';

/*MOSTRAR NOMBRE Y APELLIDOS DE LAS PERSONAS NACIDAS DESPUÉS DE 1988 ORDENADAS DE MÁS JOVENES A MÁS VIEJAS*/
SELECT NOMBRE, APELLIDO FROM PERSONA WHERE FECHA_NTO >= TO_DATE(1989, 'YYYY') ORDER BY FECHA_NTO ASC;

/*MUESTRA EL NUMERO DE MATRICULA DEL ALUMNO CON TELEFONO 66699878*/
SELECT NUMEROMATRICULA FROM ALUM_ASIG WHERE IDALUMNO =
    (SELECT IDALUMNO FROM ALUMNO WHERE DNI =
        (SELECT DNI FROM PERSONA WHERE TELEFONO = '66699878'));

/*MOSTRAR QUE ASIGNATURA CURSA EL ALUMNO PEPA GARCIA:*/
SELECT NOMBRE FROM ASIGNATURA WHERE IDASIGNATURA = 
                                (SELECT IDASIGNATURA FROM ALUM_ASIG WHERE IDALUMNO =
                                        (SELECT IDALUMNO FROM ALUMNO WHERE DNI IN 
                                                (SELECT DNI FROM PERSONA WHERE NOMBRE = 'PEPA' AND APELLIDO = 'GARCIA')));






